#!/bin/bash

TESTSCRIPT=$1

ansible-checkout-versions

CWD=$(pwd)
VERSIONS=$(ansible-list-versions)
BASEDIR=/tmp

RESULTS=""

for VERSION in $VERSIONS; do
    echo "###################################"
    echo $VERSION
    echo "###################################"
    VERSIONDIR="$BASEDIR/ansible.$VERSION"
    HACKING="$VERSIONDIR/hacking/env-setup"
    if [ -f $HACKING ]; then
        source $(which ansible-clear-hacking)
        source $HACKING > /dev/null 2>&1
    fi

    bash $TESTSCRIPT
    RC=$?
    RESULTS="$RESULTS;$VERSION:$RC"

    echo ""
    echo "## RC: $RC"
    echo ""
done

IFS=';'
for RES in $RESULTS; do
    echo $RES
done
